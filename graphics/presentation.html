<!DOCTYPE html>
<html lang = "ja">
    <head>
        <title>配信用画面</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
        <link href = "./css/presentation.css" rel = "stylesheet">
        <meta charset = "UTF-8">
        <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
    </head>
    <body>
        <!-- 1920 × 1080 px固定 -->
        <div id = "container">
            <div id = "main-wrapper">
                <div>
                    <div id = "slide"></div>

                    <div id = "pres-info">
                        <div id = "pres-speaker-box">
                            <div id = "pres-speaker"></div>
                            <ul id = "pres-speaker-info"></ul>
                        </div>
                        <div id = "pres-title-box">
                            <div id = "pres-title"></div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div id = "camera">
                        <!--<img src = "./img/no-camera.jpg" alt = "カメラ映像がない場合">-->
                    </div>
        
                    <div id = "logo">
                        <!--ロゴ-->
                    </div>
                </div>
            </div>
            
            <div id = "info-bar">
                <ul id = "info-bar-text-box">
                    <li>この後のプログラム ▶ 13:30 - 次のプログラム</li>
                </ul>
            </div>
        </div>

        <script type = "text/javascript">
            const presSpeakerElement = document.getElementById("pres-speaker");
            const presTitleElement = document.getElementById("pres-title");
            const presSpeakerInfoElement = document.getElementById("pres-speaker-info");

            let presentationData = [];
            let noticeData = [];
            let presentationNum = 0;
            let breakNum = 0;

            const generatePresSpeakerInfoLi = (num) => {
                const data = presentationData[Number(presentationNum)].info[num];

                const li = document.createElement("li");
                li.innerText = data.value;
                li.classList.add(data.type);
                li.setAttribute("data-num", num);
                return li;
            }

            const initView = () => {
                presSpeakerElement.innerText = presentationData[Number(presentationNum)].name;
                presTitleElement.innerText = presentationData[Number(presentationNum)].title;
                
                presSpeakerInfoElement.innerHTML = "";
                presSpeakerInfoElement.appendChild(generatePresSpeakerInfoLi(0));
            }

            const updateData = () => {
                fetch("./json/presentation.json")
                    .then(response => response.json())
                    .then(presentationDataBuff => {
                        presentationData = presentationDataBuff;
                        console.log(presentationData);
                        fetch("./json/notice.json")
                            .then(response => response.json())
                            .then(noticeDataBuff => {
                                noticeData = noticeDataBuff;

                                initView(); // 暫定。本来はnextPresSpeakerInfoにおいて反映させる仕組みにしたい。
                                return false;
                            });
                    });
            }
            nodecg.listenFor("reloadData", updateData);
            
            nodecg.Replicant("presentationNum").on("change", (newValue, oldValue) => {
                presentationNum = newValue;
                initView(); // 即座に画面の全情報を更新
            });
            
            updateData();
            initView(); // 書き方まずそう

            const nextPresSpeakerInfo = () => {
                
            }
        </script>
    </body>
</html>