<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta lang="ja" />
    <title>データの更新</title>
</head>
<body>
    <p>更新ボタンを押すとすべてのJSONファイルを再読み込みし、情報を更新して画面に反映します。</p>
    <p>更新後のデータは、タイトルと発表者名は即座に、それ以外の切り替わる情報はアニメーションが一周した際に反映されます（厳密には次のDOMの生成時、つまり最後のデータの表示時）。</p>
    <p>発表者画面と待機画面で、発表内容とニュースの両方が変更が反映されます。</p>
    <form onsubmit="return updateData();">
        <input type="submit" value="更新" />
    </form>
</body>
<script type="text/javascript">
window.onload = function() {
    if (presentationReplicant.value.length == 0 || noticeReplicant.value.length == 0) {
        updateData();
    }
}

const presentationReplicant = nodecg.Replicant("presentationData", {
    defaultValue: []
});

const noticeReplicant = nodecg.Replicant("noticeData", {
    defaultValue: []
});

function updateData() {
    fetch("/bundles/2024-rikoten-conf-layouts/graphics/json/presentation.json")
        .then(response => response.json())
        .then(presentationData => {
            presentationReplicant.value = presentationData;
            fetch("/bundles/2024-rikoten-conf-layouts/graphics/json/notice.json")
                .then(response => response.json())
                .then(noticeData => {
                    noticeReplicant.value = noticeData;
                    return false;
                });
        });
}
</script>
</html>
